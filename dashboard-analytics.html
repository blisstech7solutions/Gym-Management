<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gym Analytics Dashboard</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#ff2e63;
  --secondary:#08d9d6;
  --glass:rgba(255,255,255,0.08);
}

body{
  font-family:'Montserrat',sans-serif;
  background:#05070d;
  color:#fff;
}

/* ================= HEADER ================= */
.dashboard-header{
  background:
    linear-gradient(to right,rgba(255,46,99,.85),rgba(8,217,214,.85)),
    url("https://images.unsplash.com/photo-1534438327276-14e5300c3a48") center/cover;
  border-radius:24px;
  padding:35px 25px;
  margin:20px;
}

.dashboard-header h2{
  font-weight:800;
  margin-bottom:5px;
}

.dashboard-header p{
  opacity:.9;
  margin:0;
}

/* ================= ACTION BAR ================= */
.action-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:15px;
  flex-wrap:wrap;
  margin:0 20px 20px;
}

.btn-primary{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  border:none;
  font-weight:600;
}

.btn-outline-primary{
  border-color:var(--secondary);
  color:var(--secondary);
}
.btn-outline-primary:hover{
  background:var(--secondary);
  color:#000;
}

/* Mobile compact buttons */
.icon-btn{
  display:flex;
  align-items:center;
  gap:6px;
}
@media (max-width:576px){
  .icon-btn{
    padding:8px 10px;
    border-radius:50%;
    justify-content:center;
  }
  .icon-btn .btn-text{
    display:none;
  }
}

/* ================= KPI CARDS ================= */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:16px;
  margin:20px;
}

.stat-card{
  position:relative;
  background:var(--glass);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:20px;
}

.stat-card i{
  position:absolute;
  top:15px;
  right:15px;
  font-size:22px;
  opacity:.3;
}

.stat-card h3{
  font-size:24px;
  margin:0;
  font-weight:800;
}

.stat-card p{
  margin:0;
  font-size:12px;
  color:#ccc;
}

/* ================= CHARTS ================= */
.charts{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:20px;
  margin:20px;
}

.chart-box{
  background:var(--glass);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:18px;
}

.chart-box h6{
  text-align:center;
  margin-bottom:10px;
  color:#ddd;
}

/* ================= FOOTER ================= */
.footer{
  background:#02030a;
  text-align:center;
  padding:18px;
  font-size:13px;
  color:#aaa;
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="dashboard-header">
  <h2>Analytics Dashboard</h2>
  <p id="gymDetails">—</p>
</div>

<!-- ================= ACTION BAR ================= -->
<div class="action-bar">
  <h5 class="m-0">Analytics Overview</h5>
  <div class="d-flex gap-2 align-items-center">
    <button class="btn btn-outline-primary icon-btn"
      onclick="location.href='gym-dashboard.html'">
      <i class="fas fa-users"></i>
      <span class="btn-text">Dashboard</span>
    </button>
    <!-- <button class="btn btn-primary icon-btn">
      <i class="fas fa-chart-line"></i>
      <span class="btn-text">Analytics</span>
    </button> -->
  </div>
</div>

<!-- ================= KPIs ================= -->
<div class="stats">
  <div class="stat-card">
    <i class="fas fa-users"></i>
    <h3 id="totalMembers">0</h3>
    <p>Total Members</p>
  </div>
  <div class="stat-card">
    <i class="fas fa-user-check"></i>
    <h3 id="activeMembers">0</h3>
    <p>Active Members</p>
  </div>
  <div class="stat-card">
    <i class="fas fa-user-times"></i>
    <h3 id="expiredMembers">0</h3>
    <p>Expired Members</p>
  </div>
  <div class="stat-card">
    <i class="fas fa-clock"></i>
    <h3 id="expiringSoon">0</h3>
    <p>Expiring ≤ 5 Days</p>
  </div>
  <div class="stat-card">
    <i class="fas fa-calendar-week"></i>
    <h3 id="weekRevenue">₹0</h3>
    <p>This Week Revenue</p>
  </div>
  <div class="stat-card">
    <i class="fas fa-calendar-alt"></i>
    <h3 id="monthRevenue">₹0</h3>
    <p>This Month Revenue</p>
  </div>
</div>

<!-- ================= CHARTS ================= -->
<div class="charts">
  <div class="chart-box">
    <h6>Members Status</h6>
    <canvas id="membersChart"></canvas>
  </div>
  <div class="chart-box">
    <h6>Paid vs Pending</h6>
    <canvas id="paymentChart"></canvas>
  </div>
  <div class="chart-box">
    <h6>Revenue (Last 6 Months)</h6>
    <canvas id="monthlyChart"></canvas>
  </div>
</div>

<footer class="footer">
  © 2025 BlissTech7 Solutions | blisstech7solutions@gmail.com
</footer>

<!-- ================= FIREBASE & LOGIC ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCY5-w3jLyC9iXN8Kh26wGIVia1zGuGwyk",
  authDomain: "gym-management-50b12.firebaseapp.com",
  projectId: "gym-management-50b12",
  storageBucket: "gym-management-50b12.appspot.com",
  messagingSenderId: "202067078338",
  appId: "1:202067078338:web:6ad435b248f3230d7cdf5b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const safe = v => Number(v || 0);
const safeDate = d => {
  const x = new Date(d);
  return isNaN(x.getTime()) ? null : x;
};

const daysRemaining = d=>{
  const t=new Date(); t.setHours(0,0,0,0);
  const r=new Date(d); r.setHours(0,0,0,0);
  return Math.floor((r-t)/(1000*60*60*24));
};

onAuthStateChanged(auth, async user=>{
  if(!user){
    location.href="index.html";
    return;
  }

  const uid=user.uid;

  const gymDoc=await getDoc(doc(db,"gyms",uid));
  if(gymDoc.exists()){
    const g=gymDoc.data();
    gymDetails.textContent=`${g.gymName} | ${g.address}`;
  }

  const snap=await getDocs(collection(db,"gyms",uid,"members"));

  let total=0, active=0, expired=0, soon=0;
  let weekRev=0, monthRev=0, paid=0, pending=0;

  const today=new Date();
  const weekStart=new Date(today); weekStart.setDate(today.getDate()-today.getDay());
  const monthStart=new Date(today.getFullYear(),today.getMonth(),1);

  const months=[...Array(6)].map((_,i)=>{
    const d=new Date(today.getFullYear(),today.getMonth()-5+i,1);
    return d.toLocaleString('default',{month:'short'});
  });
  const monthData=new Array(6).fill(0);

  snap.forEach(d=>{
    const m=d.data();
    total++;

    const dr=daysRemaining(m.renewalDate);
    if(dr<0) expired++; else active++;
    if(dr>=0 && dr<=5) soon++;

    const amt=safe(m.paymentAmount);
    const join=safeDate(m.joiningDate);

    if(m.paymentStatus==="Paid") paid+=amt;
    else pending+=amt;

    if(join){
      if(join>=weekStart) weekRev+=amt;
      if(join>=monthStart) monthRev+=amt;

      const idx=(today.getMonth()-join.getMonth()+12)%12;
      if(idx<6) monthData[5-idx]+=amt;
    }
  });

  totalMembers.textContent=total;
  activeMembers.textContent=active;
  expiredMembers.textContent=expired;
  expiringSoon.textContent=soon;
  weekRevenue.textContent="₹"+weekRev;
  monthRevenue.textContent="₹"+monthRev;

  new Chart(membersChart,{
    type:"pie",
    data:{labels:["Active","Expired"],datasets:[{data:[active,expired]}]}
  });

  new Chart(paymentChart,{
    type:"bar",
    data:{labels:["Paid","Pending"],datasets:[{data:[paid,pending]}]}
  });

  new Chart(monthlyChart,{
    type:"line",
    data:{labels:months,datasets:[{data:monthData,fill:true}]}
  });
});
</script>

</body>
</html>
