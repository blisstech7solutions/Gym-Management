<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gym Dashboard</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#ff2e63;
  --secondary:#08d9d6;
  --dark:#06080f;
  --glass:rgba(255,255,255,0.08);
}

body,html{
  height:100%;
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:#05070d;
  color:#fff;
  display:flex;
  flex-direction:column;
}

/* ================= GLOBAL STATES ================= */
.highlight{background:rgba(255,46,99,0.15)!important;}
.days-warning{background:#ff9800!important;color:#000;font-weight:700;}
.days-critical{background:#dc3545!important;color:#fff;font-weight:700;}

/* ================= HEADER WITH IMAGE ================= */
.dashboard-header{
  position:relative;
  background:
    linear-gradient(to bottom,rgba(0,0,0,.55),rgba(0,0,0,.9)),
    url("https://images.unsplash.com/photo-1534438327276-14e5300c3a48") center/cover;
  border-radius:24px;
  padding:60px 25px;
  margin:20px;
  box-shadow:0 25px 60px rgba(0,0,0,.7);
}

.dashboard-header h2{
  font-weight:800;
  color:var(--primary);
  font-size:clamp(26px,5vw,38px);
}

.dashboard-header p{
  font-size:14px;
  color:#ddd;
  margin-top:5px;
}

/* ================= CONTAINER ================= */
.container-custom{
  max-width:1400px;
  margin:auto;
  padding:10px 20px 40px;
}

/* ================= ACTION BAR ================= */
.action-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:15px;
  flex-wrap:wrap;
  margin-bottom:30px;
}

.btn-custom{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#000;
  border:none;
  border-radius:30px;
  padding:10px 26px;
  font-weight:700;
  transition:.3s;
}
.btn-custom:hover{transform:scale(1.05);}

/* ================= TABLE ================= */
.table{
  background:var(--glass);
  backdrop-filter:blur(14px);
  border-radius:18px;
  overflow:hidden;
  color:#fff;
}

.table th{
  background:rgba(255,255,255,.15)!important;
  color:#fff;
  font-size:13px;
}

.table td{
  font-size:13px;
  vertical-align:middle;
}

/* ================= WHATSAPP ================= */
.whatsapp-button{
  background:#25D366;
  border:none;
  border-radius:30px;
  padding:6px 12px;
  display:inline-flex;
  align-items:center;
}
.whatsapp-button:hover{background:#1ebe5d;}
.whatsapp-icon{width:20px;height:20px;}

/* ================= MEMBER CARD (MOBILE) ================= */
.member-card{
  background:
    linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,.8)),
    url("https://images.unsplash.com/photo-1571019613578-2b1931c9b34b") center/cover;
  border-radius:22px;
  padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
  transition:.4s;
  height:100%;
}

.member-card:hover{
  transform:translateY(-6px);
  box-shadow:0 25px 60px rgba(255,46,99,.4);
}

.member-card h5{
  color:var(--secondary);
  font-weight:700;
}

.member-card p{
  font-size:13px;
  color:#ddd;
}

/* ================= FOOTER ================= */
.footer{
  background:#02030a;
  text-align:center;
  padding:18px;
  margin-top:auto;
  font-size:13px;
  color:#aaa;
}

/* ================= RESPONSIVE SWITCH ================= */
@media (min-width:768px){
  #memberTable-container{display:block;}
  #memberCards{display:none;}
}
@media (max-width:767px){
  #memberTable-container{display:none;}
  #memberCards{display:block;}
}
</style>
</head>

<body>

<!-- ===== HEADER WITH GYM INFO ===== -->
<div class="dashboard-header">
  <h2>Gym Dashboard</h2>
  <p id="gym-details"></p>
</div>

<div class="container-custom">

  <!-- ===== ACTION BAR ===== -->
  <div class="action-bar">
    <h4 class="m-0">My Gym Members</h4>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-danger" id="logoutBtn">Logout</button>
      <button class="btn btn-custom" id="addMemberBtn">Add Member</button>
    </div>
  </div>

  <!-- ===== APPROVAL MESSAGE ===== -->
  <div id="approval-message" class="alert alert-warning d-none text-center">
    <b>Thank you for registering your gym.</b><br>
    Your account is currently under admin review.
  </div>

  <!-- ===== TABLE VIEW ===== -->
  <div id="memberTable-container">
    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Mobile</th>
          <th>Joining</th>
          <th>Duration</th>
          <th>Renewal</th>
          <th>Total</th>
          <th>Payment</th>
          <th>Status</th>
          <th>Remaining</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="member-list"></tbody>
    </table>
  </div>

  <!-- ===== CARD VIEW (MOBILE) ===== -->
  <div id="memberCards" class="row row-cols-1 row-cols-md-2 row-cols-lg-3"></div>

</div>

<footer class="footer">
  © 2025 BlissTech7 Solutions | blisstech7solutions@gmail.com
</footer>

<!-- ===================== SCRIPTS (UNCHANGED FUNCTIONALITY) ===================== -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCY5-w3jLyC9iXN8Kh26wGIVia1zGuGwyk",
  authDomain: "gym-management-50b12.firebaseapp.com",
  projectId: "gym-management-50b12",
  storageBucket: "gym-management-50b12.appspot.com",
  messagingSenderId: "202067078338",
  appId: "1:202067078338:web:6ad435b248f3230d7cdf5b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
let currentUserId;

/* ===== SAME LOGIC ===== */
const calculateDaysRemaining=(joiningDate,duration,renewalDate)=>{
  const rd=new Date(renewalDate);
  const now=new Date();
  const diff=Math.floor((rd-now)/(1000*3600*24));
  return {renewalDaysRemaining:diff,displayText:diff<0?`Expired ${Math.abs(diff)} days ago`:`${diff} days`};
};

const renderMembers=(members)=>{
  const tbody=document.getElementById("member-list");
  const cards=document.getElementById("memberCards");
  tbody.innerHTML=""; cards.innerHTML="";

  members.forEach(m=>{
    const {renewalDaysRemaining,displayText}=calculateDaysRemaining(m.joiningDate,m.duration,m.renewalDate);
    let cls=renewalDaysRemaining<2?'days-critical':renewalDaysRemaining<5?'days-warning':'';

    tbody.innerHTML+=`
    <tr class="${renewalDaysRemaining<5?'highlight':''}">
      <td>${m.name}</td><td>${m.email}</td><td>${m.mobile}</td>
      <td>${m.joiningDate}</td><td>${m.duration}</td><td>${m.renewalDate}</td>
      <td>${m.daysTotal} days</td><td>₹${m.paymentAmount}</td>
      <td>${m.paymentStatus}</td>
      <td class="${cls}">${displayText}</td>
      <td>
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-warning" onclick="location.href='edit-member.html?id=${m.id}'">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteMember('${m.id}')">Delete</button>
          <button class="whatsapp-button" onclick="sendWhatsApp('${m.mobile}','${m.name}','${renewalDaysRemaining}')">
            <img src="https://cdn-icons-png.flaticon.com/512/124/124034.png" class="whatsapp-icon">
          </button>
        </div>
      </td>
    </tr>`;

    cards.innerHTML+=`
    <div class="col mb-4">
      <div class="member-card ${cls}">
        <h5>${m.name}</h5>
        <p>Email: ${m.email}</p>
        <p>Mobile: ${m.mobile}</p>
        <p>Renewal: ${displayText}</p>
        <div class="d-flex gap-2">
          <button class="btn btn-warning btn-sm" onclick="location.href='edit-member.html?id=${m.id}'">Edit</button>
          <button class="btn btn-danger btn-sm" onclick="deleteMember('${m.id}')">Delete</button>
        </div>
      </div>
    </div>`;
  });
};

window.sendWhatsApp=(mob,name,days)=>{
  window.open(`https://wa.me/${mob}?text=${encodeURIComponent(`Hello ${name}, your membership expires in ${days} days.`)}`);
};

window.deleteMember=async(id)=>{
  if(confirm("Delete member?")){
    await deleteDoc(doc(db,"gyms",currentUserId,"members",id));
    loadMembers();
  }
};

const loadMembers=async()=>{
  const snap=await getDocs(collection(db,"gyms",currentUserId,"members"));
  const arr=[];
  snap.forEach(d=>{let x=d.data();x.id=d.id;arr.push(x);});
  renderMembers(arr);
};

const loadGymDetails=async()=>{
  const gymDoc=await getDoc(doc(db,"gyms",currentUserId));
  if(gymDoc.exists()){
    const g=gymDoc.data();
    document.getElementById("gym-details").textContent=`${g.gymName} | ${g.address}`;
  }
};

onAuthStateChanged(auth,user=>{
  if(user){
    currentUserId=user.uid;
    loadGymDetails();
    loadMembers();
  } else location.href="index.html";
});

$("#logoutBtn").click(()=>signOut(auth));
$("#addMemberBtn").click(()=>location.href="add-member.html");
</script>

</body>
</html>
